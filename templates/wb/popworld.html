{% extends "layouts/base.html" %}

{% block title %} Populate world {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}
{% block script %}

{% endblock script %}

{% block content %}

  <div class="py-4">
    
      <div class="d-flex justify-content-between w-100 flex-wrap">
          <div class="mb-3 mb-lg-0">
              <h1 class="h4">Write your Story: {{gen.name}}</h1>

          </div>
          
      </div>
  </div>
<div class="row mb-3" id="graph">
</div>
  <div class="row mb-3">
    Write Your Story:
   <textarea rows="10" cols="4" style="width:80%">
    {% for k in config['world'] %}
      {% for kk in config['world'][k] %}{{" "* (kk.itempb | int) }}{{kk.item}}
      {% endfor %}
    {% endfor %}
    
   </textarea>
   <div class="row mb-3" id="bar">
</div>


      <script>

// create data
var data = []
{% for c in config['all'] %}
  var k = {};
  {% for k in c.keys() %}
  try {

    var i = {{c[k]}} * random(1,5)
    
  k["{{k}}"] = i;

  alert("hi");
  }catch(e){
     k["{{k}}"] = "{{c[k]}}"; 
  }
      

  {% endfor %}
  data.push(k);
{% endfor %}



//var data = [{group: "animal", variable:"2",x: 0, y: 20, value:20}, {group: "animal", value: 150, x: 150, variable:"4", y: 150}, {group: "grass", variable:"4", value: 300, x: 300, y: 100}, {group: "grass", variable:"4", x: 450, y: 20, value:450}, {group:"insect", x: 600, y: 130, value:600, variable:"5"}];

// create svg element:

var svg = d3.select("#graph").append("svg").attr("width", 800).attr("height", 400)

// prepare a helper function
var lineFunc = d3.line()
  .x(function(d) { return d.item.length*100 })
  .y(function(d) { return d.itempb*100});

// Add the path using this helper function
svg.append('path')
  .attr('d', lineFunc(data))
  .attr('stroke', 'black')
  .attr('fill', 'none');

for (var d = 0; d < data.length; d++){
if (data[d].item){
            svg.append('text')
             .attr('class', 'barsEndlineText')
             .attr('text-anchor', 'bottom')
             .attr("x", data[d].item.length*100)
             .attr("y", data[d].itempb*100)
             .text(data[d].item) 
           }
           
    }
      //d3.select(".row").append("p").text("Hello World!");



var margin = {top:-800, right: 25, bottom: 30, left: 40},
  width = 450 - margin.left - margin.right,
  height = 450 - margin.top - margin.bottom;

var svg = d3.select("#bar").append("svg").attr("width", 800).attr("height", 400)


  var myGroups = d3.map(data, function(d){return d.item;}).keys()
  var myVars = d3.map(data, function(d){return d.itempb;}).keys()
console.log(myGroups);
console.log(myVars);
  // Build X scales and axis:
  var x = d3.scaleBand()
    .range([ 0, width ])
    .domain(myGroups)
    .padding(0.05);
  svg.append("g")
    .style("font-size", 15)
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x).tickSize(0))
    .select(".domain").remove()

  // Build Y scales and axis:
  var y = d3.scaleBand()
    .range([ height, 0 ])
    .domain(myVars)
    .padding(0.05);
  svg.append("g")
    .style("font-size", 15)
    .call(d3.axisLeft(y).tickSize(0))
    .select(".domain").remove()

  // Build color scale
  //var myColor = d3.scaleSequential()
   // .interpolator(d3.interpolateInferno)
    //.domain([1,100])

  var myColor = d3.scaleLinear()
  .domain([0, 100])
  .range(["#00ff000", "#ff00ff"]);
  console.log(myColor);

  // create a toolti
  var Tooltip = d3.select(".row")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")

  // Three function that change the tooltip when user hover / move / leave a cell
  var mouseover = function(d) {
    Tooltip
      .style("opacity", 1)
    d3.select(this)
      .style("stroke", "black")
      .style("opacity", 1)
  }
  var mousemove = function(d) {
    Tooltip
      .html(d.item)
      .style("left", (d3.mouse(this)[0]+70) + "px")
      .style("top", (d3.mouse(this)[1]) + "px")
  }
  var mouseleave = function(d) {
    Tooltip
      .style("opacity", 0)
    d3.select(this)
      .style("stroke", "none")
      .style("opacity", 0.8)
  }


  // add the squares
  svg.selectAll()
    .data(data, function(d) {return d.item+':'+d.pbitem;})
    .enter()
    .append("rect")
      .attr("x", function(d) { return x(d.item) })
      .attr("y", function(d) { return y(d.pbitem) })
      .attr("rx", 4)
      .attr("ry", 4)
      .attr("width", x.bandwidth() )
      .attr("height", y.bandwidth() )
      .style("fill", function(d) { return myColor(Math.round(Math.random(0,40),1))} )
      .style("stroke-width", 4)
      .style("stroke", "none")
      .style("opacity", 0.8)
    .on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave)

      </script>
  </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}{% endblock javascripts %}
